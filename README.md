# Google Calendar Time Slot Selector

Googleカレンダー上で空白箇所をドラッグ選択して、日時範囲をまとめてコピーできるChrome拡張機能です。

## 機能

- **ドラッグ選択**: カレンダー上の空白箇所をドラッグして時間帯を選択
- **15分単位スナップ**: 選択範囲を15分単位に自動調整
- **複数選択**: 複数の時間帯を選択してまとめてコピー可能
- **自動ソート**: 選択した時間帯を日時順に自動整理
- **見やすいUI**: ドラッグ可能なフローティングパネルで選択中の時間を常に確認
- **視覚的フィードバック**: 選択範囲を半透明のオーバーレイで表示
- **多言語対応**: 日本語・英語のGoogleカレンダーに対応
- **型安全**: TypeScriptで実装された堅牢なコード
- **セキュア**: XSS対策済み（innerHTML不使用）

## スクリーンショット

<!-- TODO: スクリーンショットを追加 -->

## インストール方法

### 前提条件

- Node.js 18.x 以上
- npm または yarn

### ビルドとインストール

1. このリポジトリをクローン:
   ```bash
   git clone https://github.com/rasshii/google-calendar-event-selector.git
   cd google-calendar-event-selector
   ```

2. 依存関係をインストール:
   ```bash
   npm install
   ```

3. プロジェクトをビルド:
   ```bash
   npm run build
   ```

4. Chromeで拡張機能ページを開く:
   - `chrome://extensions/` にアクセス
   - または、メニュー > その他のツール > 拡張機能

5. 「デベロッパーモード」を有効化（右上のトグル）

6. 「パッケージ化されていない拡張機能を読み込む」をクリック

7. プロジェクトの `dist` フォルダを選択

8. Googleカレンダー（https://calendar.google.com）を開いて使用開始

## 使い方

### 基本的な使い方

1. Googleカレンダー（週表示）を開くと、右上にフローティングパネルが表示されます

2. **時間帯を選択**:
   - カレンダー上の空白箇所をマウスでドラッグ
   - 選択範囲が紫色の半透明ボックスで表示されます
   - 自動的に15分単位に調整されます

3. **複数選択**:
   - 続けて別の時間帯をドラッグして追加選択
   - 選択した時間帯はパネルにリスト表示されます

4. **コピー**:
   - 「📋 コピー」ボタンをクリック
   - 選択した時間帯がクリップボードにコピーされます

5. **削除**:
   - 個別削除: 各時間帯の「×」ボタンをクリック
   - 全削除: 「🗑️ クリア」ボタンで全選択をクリア

### コピー形式

選択した時間帯は以下の形式でコピーされます:

**日本語カレンダー:**
```
11月20日(水) 14:00~15:30
11月21日(木) 9:00~10:00
```

**英語カレンダー:**
```
Nov 20 (Wed) 2PM-3:30PM
Nov 21 (Thu) 9AM-10AM
```

### パネル操作

- **ドラッグ**: ヘッダーをドラッグしてパネルを自由に移動
- **最小化**: ヘッダーの「−」ボタンで最小化/展開

## 技術仕様

### 対応ブラウザ
- Google Chrome (Manifest V3対応)
- その他のChromiumベースのブラウザ（Edge, Brave等）

### 対応ページ
- Googleカレンダー (https://calendar.google.com/*)
- 週表示に対応（日表示・月表示は非対応）
- 日本語・英語版に対応

### 使用技術
- **TypeScript**: 型安全な実装
- **Vite**: 高速ビルドツール
- **Manifest V3**: 最新のChrome拡張機能仕様
- **モジュラーアーキテクチャ**: 保守性の高いコード構造

## ファイル構成

```
google-calendar-event-selector/
├── src/                    # TypeScriptソースコード
│   ├── content.ts          # エントリーポイント
│   ├── types/              # 型定義
│   ├── config/             # 設定定数
│   ├── core/               # コアロジック
│   │   ├── grid-analyzer.ts    # グリッド解析
│   │   ├── drag-handler.ts     # ドラッグハンドリング
│   │   └── slot-manager.ts     # スロット管理
│   ├── ui/                 # UI関連
│   │   ├── panel.ts            # パネルUI
│   │   ├── overlay.ts          # オーバーレイ管理
│   │   └── notification.ts     # 通知UI
│   └── utils/              # ユーティリティ
│       ├── locale.ts           # ロケール処理
│       ├── formatter.ts        # フォーマッター
│       └── time.ts             # 時間計算
├── public/                 # 静的ファイル
│   ├── manifest.json       # 拡張機能設定
│   ├── styles.css          # スタイルシート
│   └── icon*.png          # アイコン
├── dist/                   # ビルド出力（gitignore）
├── package.json           # npm設定
├── tsconfig.json          # TypeScript設定
├── vite.config.ts         # Vite設定
└── README.md              # このファイル
```

## 開発

### ローカル開発

1. リポジトリをクローン
2. 依存関係をインストール: `npm install`
3. 開発モードでビルド: `npm run dev`
   - ファイル変更を監視して自動リビルド
4. Chrome拡張機能ページで「更新」ボタンをクリック
5. Googleカレンダーをリロードして動作確認

### ビルドコマンド

```bash
# 開発ビルド（ウォッチモード）
npm run dev

# プロダクションビルド
npm run build

# 型チェックのみ
npm run type-check

# ディレクトリクリーン
npm run clean
```

### デバッグ

- Chromeデベロッパーツールでコンソールログを確認
- `Google Calendar Time Slot Selector が初期化されました` が表示されれば正常動作
- ソースマップが有効なので、TypeScriptファイルでデバッグ可能

## アーキテクチャ

### セルフドキュメンティングコード

- **明確な命名**: 関数名・変数名が意図を明確に表現
- **型安全性**: TypeScriptによる静的型チェック
- **モジュール分割**: 単一責任の原則に基づく設計
- **JSDocコメント**: 重要な関数に詳細な説明

### 主要クラス

- `GridAnalyzer`: カレンダーグリッドの解析とキャッシュ
- `DragHandler`: マウスドラッグイベントの処理
- `SlotManager`: 選択された時間スロットの管理
- `TimeSlotSelectorApp`: アプリケーション全体の制御

## 既知の問題

- 月表示・日表示では動作しません（週表示のみ対応）
- 複数日にまたがる選択はできません（同日内のみ）
- 終日イベントの選択には非対応

## 今後の改善予定

- [ ] 日表示・月表示への対応
- [ ] カスタマイズ可能なコピー形式（設定画面）
- [ ] ショートカットキーのサポート
- [ ] 選択範囲のプリセット保存機能
- [ ] Chrome Web Storeへの公開

## 変更履歴

### v2.0.0 (2024-11-14)
- 機能を完全に刷新: 既存予定の選択 → 空白時間帯のドラッグ選択
- TypeScript + Viteベースのモジュラー構造に移行
- 15分単位スナップ機能を実装
- 視覚的フィードバックの改善（半透明オーバーレイ）

### v1.2.0
- コードレビューとリファクタリング
- セルフドキュメンテーションの改善

### v1.1.0
- 英語版Googleカレンダー対応
- 終日イベント対応
- パフォーマンス最適化

### v1.0.0
- 初回リリース

## ライセンス

MIT License

## 作者

rasshii

## 貢献

プルリクエストやイシューの報告を歓迎します！

1. このリポジトリをフォーク
2. 機能ブランチを作成 (`git checkout -b feature/amazing-feature`)
3. 変更をコミット (`git commit -m 'Add some amazing feature'`)
4. ブランチにプッシュ (`git push origin feature/amazing-feature`)
5. プルリクエストを作成

## サポート

問題や質問がある場合は、GitHubのIssuesページで報告してください。
